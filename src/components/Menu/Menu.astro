---
import ItemsTemplate   from "@/components/Section/ItemsTemplates/ItemsTemplate.astro";
import MenuItem        from "./MenuItem.astro";
import DefaultSubmenu   from "./Submenu.astro";

const {
  collection    = "menuItems",
  query         = "relatedItem:menus:mainMenu",
  itemsClass    = "flex gap-[var(--spacing-md)]",
  sortOrder     = "asc",
  HasPage       = false,

  menuItem = {
    component: MenuItem,
    props: {
      itemClass:    "",
      linkClass:    "",
      hierarchical: false,
      submenu: {
        // if you don’t pass a submenu object, we’ll clone this as the default
        component: DefaultSubmenu,
        itemsClass:
          "submenu absolute left-0 top-full w-40 bg-white shadow-lg opacity-0 pointer-events-none transition-opacity duration-200 ease-in-out z-[100]",
        subMenuItem: {
          component: MenuItem,
          props: {
            itemClass:    "", 
            linkClass:    "",
            hierarchical: true,
            subMenuItem:  null,
          },
        },
      },
    },
  },
} = Astro.props;

// If caller didn’t supply menuItem.props.submenu, we fill in these defaults:
let finalSubmenu = menuItem.props.submenu || {
  component: DefaultSubmenu,
  itemsClass:
    "submenu absolute left-0 top-full w-40 bg-white shadow-lg opacity-0 pointer-events-none transition-opacity duration-200 ease-in-out z-[100]",
  subMenuItem: {
    component: menuItem.component,
    props: { ...menuItem.props },
  },
};

// Build “menuItemProps” so that each top‑level <MenuItem> gets “submenu” baked in.
const menuItemProps = {
  ...menuItem.props,
  submenu: finalSubmenu,
};
---

<nav>
  <!-- Mobile (stacked) -->
  <div class="block md:hidden">
    <ItemsTemplate
      collection={collection}
      query={query}
      sortOrder={sortOrder}
      HasPage={HasPage}
      itemsClass="flex flex-col space-y-[var(--spacing-sm)]"
      ItemComponent={{
        component: menuItem.component,
        props:      menuItemProps,
      }}
    />
  </div>

  <!-- Desktop -->
  <div class={itemsClass}>
    <ItemsTemplate
      collection={collection}
      query={query}
      sortOrder={sortOrder}
      HasPage={HasPage}
      itemsClass={itemsClass}
      ItemComponent={{
        component: menuItem.component,
        props:      menuItemProps,
      }}
    />
  </div>
</nav>
