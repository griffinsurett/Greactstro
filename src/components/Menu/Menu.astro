---
import ItemsTemplate   from "@/components/Section/ItemsTemplates/ItemsTemplate.astro";
import MenuItem        from "./MenuItem.astro";
import DefaultSubmenu  from "./Submenu.astro";

const {
  collection    = "menuItems",
  query         = "relatedItem:menus:mainMenu",
  itemsClass    = "flex gap-[var(--spacing-md)]",
  sortOrder     = "asc",
  HasPage       = false,

  menuItem = {
    component: MenuItem,
    props: {
      itemClass:    "",
      linkClass:    "",
      hierarchical: false,
      submenu: {
        component: DefaultSubmenu,
        itemsClass: "",
        subMenuItem: {
          component: MenuItem,
          props: {
            itemClass:    "",
            linkClass:    "",
            hierarchical: true,
            subMenuItem:  null,
          },
        },
      },
    },
  },
} = Astro.props;

/* ————————————————————————————————————————————————————————————————
   Build a canonical “submenu” object so every top-level <MenuItem>
   receives the same defaults.
—————————————————————————————————————————————————————————————— */
const finalSubmenu =
  menuItem.props.submenu || {
    component: DefaultSubmenu,
    itemsClass: "",
    subMenuItem: {
      component: menuItem.component,
      props: { ...menuItem.props },
    },
  };

const menuItemProps = {
  ...menuItem.props,
  submenu: finalSubmenu,
};
---

<nav aria-label="Main">
  <!-- ItemsTemplate outputs a <ul>; we pass role="menubar" straight through -->
  <ItemsTemplate
    collection={collection}
    query={query}
    sortOrder={sortOrder}
    HasPage={HasPage}
    itemsClass={itemsClass}
    role="menubar"
    ItemComponent={{
      component: menuItem.component,
      props:     menuItemProps,
    }}
  />
</nav>
